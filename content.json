{"meta":{"title":"小骨子还在努力","subtitle":"还在努力","description":"","author":"xiao hong zhong","url":"http://xiaohongzhong.top","root":"/"},"pages":[{"title":"categories","date":"2020-11-18T06:58:54.000Z","updated":"2020-11-18T08:00:20.000Z","comments":true,"path":"categories/index.html","permalink":"http://xiaohongzhong.top/categories/index.html","excerpt":"","text":""},{"title":"about","date":"2020-11-18T06:59:25.000Z","updated":"2020-11-19T01:30:32.000Z","comments":true,"path":"about/index.html","permalink":"http://xiaohongzhong.top/about/index.html","excerpt":"","text":"我是小骨子，欢迎您"},{"title":"tags","date":"2020-11-18T06:58:27.000Z","updated":"2020-11-18T08:09:12.000Z","comments":true,"path":"tags/index.html","permalink":"http://xiaohongzhong.top/tags/index.html","excerpt":"","text":""},{"title":"contact","date":"2020-11-22T11:54:42.000Z","updated":"2020-11-22T11:55:46.000Z","comments":true,"path":"contact/index.html","permalink":"http://xiaohongzhong.top/contact/index.html","excerpt":"","text":""}],"posts":[{"title":"supervisor + scrapy + python","slug":"supervisor-scrapy-python","date":"2020-11-26T06:42:57.000Z","updated":"2020-11-26T09:57:28.253Z","comments":true,"path":"2020/11/26/supervisor-scrapy-python/","link":"","permalink":"http://xiaohongzhong.top/2020/11/26/supervisor-scrapy-python/","excerpt":"","text":"在ubuntu16.04下最近在做一个项目，它是在服务器部署，首先我们的人员请求爬取新浪微博的话题和关键词，然后会返回爬到的微博用户id，bid，和图像url。之后再把这些图像送到深度学习所做的图像侵权检测系统，判断是否侵权我们的素材，返回相关的信息。 1.图像侵权检测 2.python 开启http服务 3.scrapy 爬取新浪微博 4.supervisor 进程管理 其实123慢慢调好了，这周调的最多的是怎么把1234放在一起，碰到了相当多的问题。 开启supervisor 执行的命令可以是虚拟环境的命令，需要加上路径比如 [program:ibaotu-image-match]command=/usr/local/data/anaconda3/envs/snakes/bin/python /usr/local/data/www/weibo_search_master/http_server_GET.pydirectory=/usr/local/data/www/weibo_search_masterautostart=trueautorestart=truestdout_logfile=/usr/local/data/www/log/out.logstderr_logfile=/usr/local/data/www/log/err.log 执行命令的时候就知道是执行哪里的python了 还可以web查看管理supervisor [inet_http_server] ; inet (TCP) server disabled by defaultport=*:9001 ; (ip_address:port specifier, *:port for all iface);username=admin ; (default is no username (open server));password=admin ; (default is no password (open server)) supervisor命令查看状态supervisorctl status更新supervisorctl update重置supervisorctl reload结束supervisorctl stop all开始supervisorctl start all更新配置supervisord -c /etc/supervisord/supervisord.conf 遇到的报错 unix:///var/run/supervisor.sock no such file 1.sudo touch /var/run/supervisor.sock 2.sudo chmod 777 /var/run/supervisor.sock 3.sudo service supervisor restart unix:///var/run/supervisor/supervisor.sock refused connection supervisord -c /etc/supervisord/supervisord.conf启动supervisord并使用配置 The ‘supervisor==3.2.0’ distribution was not found and is required by the application 如果默认的python是python2,应该不会报错。如果是python3，就要修改和terminator一样也是python版本引起的，编辑/usr/bin/supervisord将#!/usr/bin/python修改为#!/usr/bin/python2即可貌似启动supervisor 只能用python2 supervisord不能正常地话，查看它的log supervisorctl tail ibaotu-image-match stderr supervisorctl 启动起来，一直在报错重启， OSError: [Errno 98] Address already in use 1.netstat -tunlpkill -9 6153这个是每次都要这样，有点烦2.find / -name supervisor.sockunlink /name/supervisor.sock root@ibaotu-algo:/usr/bin# scrapyTraceback (most recent call last): File “/usr/local/bin/scrapy”, line 7, in from scrapy.cmdline import execute File “/usr/local/lib/python3.5/dist-packages/scrapy/init.py”, line 12, in from scrapy.spiders import Spider File “/usr/local/lib/python3.5/dist-packages/scrapy/spiders/init.py”, line 22 name: Optional[str] = None ^SyntaxError: invalid syntax 在虚拟环境是好的，但是放在一起跑就出问题了。我研究了好久，才发现还是命令路径的问题。在终端输入scrapy，虚拟环境是ok的，在普通的就报错。两个scrapy版本是一样的，只不过虚拟环境的python是3.6.5，普通的python是3.5.2，不知道是不是和这个有关。把scrapy改成/usr/local/data/anaconda3/envs/snakes/bin/scrapy scrapy是命令行，怎么在代码里面添加？ 123#cmdline.execute([&quot;scrapy&quot;, &quot;crawl&quot;, &quot;search&quot;, &quot;-a&quot;, &quot;start_date&#x3D;%s&quot;%(start_date), &quot;-a&quot;, &quot;end_date&#x3D;%s&quot;%(end_date), &quot;-a&quot;, &quot;keyword_list&#x3D;%s&quot;%(keyword)])cmd &#x3D; &quot;&#x2F;usr&#x2F;local&#x2F;data&#x2F;anaconda3&#x2F;envs&#x2F;snakes&#x2F;bin&#x2F;scrapy crawl search -a &quot; + &quot;start_date&#x3D;%s&quot;%(start_date) + &quot; -a &quot; + &quot;end_date&#x3D;%s&quot;%(end_date) + &quot; -a &quot; + &quot;keyword_list&#x3D;%s&quot;%(keyword)os.system(cmd) 开启的http服务，客户请求爬虫，怎么把数据返回？ 一开始的想法是能不能搞个全局变量。怎么搞也搞不过去，python跨文件的全局变量，后面知道scrapy是新开的进程，数据根本到不了。后面把数据存到csv或者json文件，爬完再读取，再返回。 no module named … 因为路径的问题，也搞了好久，明明都添加了，还是报错，sys.path.append()最后因为没有使用到全局变量，这个报错也就不了了之了。 遍历字典，写入csv，一个数据固定的写入一行 writer.writerow([item[‘weibo’][key] for key in item[‘weibo’].keys() if key == ‘id’ or key == ‘bid’ or key == ‘pics’]) 是csv转成json，还是直接爬取pipeline到json 我选择了后者，爬取了json格式的文件下来，包括id，bid，picurl组成的json格式的数据。一开始json格式还写不进去，应该是格式问题，我弄了data格式，之后ok了。 12345678910with codecs.open(jsonfile_path, &#39;a+&#39;) as f: data &#x3D; &#123; &#39;id&#39;: item[&#39;weibo&#39;][&#39;user_id&#39;], &#39;bid&#39;: item[&#39;weibo&#39;][&#39;bid&#39;], &#39;screen_name&#39;: item[&#39;weibo&#39;][&#39;screen_name&#39;], &#39;pics&#39;: item[&#39;weibo&#39;][&#39;pics&#39;] &#125; lines &#x3D; json.dumps(data, ensure_ascii&#x3D;False) f.write(lines + &quot;\\n&quot;) 然后也出现supervisor一直重启的问题 因为配置中restart:默认为true，然后一直有htpp进程开着，报错OSError: [Errno 98] Address already in use；还有个原因就是原来的程序不是死循环，一会运行结束，又重启了。 最后这个1234基本就能愉快地在一起玩耍了。","categories":[{"name":"项目经验","slug":"项目经验","permalink":"http://xiaohongzhong.top/categories/%E9%A1%B9%E7%9B%AE%E7%BB%8F%E9%AA%8C/"}],"tags":[{"name":"爬虫","slug":"爬虫","permalink":"http://xiaohongzhong.top/tags/%E7%88%AC%E8%99%AB/"},{"name":"python","slug":"python","permalink":"http://xiaohongzhong.top/tags/python/"}]},{"title":"paddle学习","slug":"paddle学习","date":"2020-11-25T14:36:51.000Z","updated":"2020-11-26T06:39:31.874Z","comments":true,"path":"2020/11/25/paddle-xue-xi/","link":"","permalink":"http://xiaohongzhong.top/2020/11/25/paddle-xue-xi/","excerpt":"","text":"波士顿房价预测任务 对于预测问题，可以根据预测输出的类型是连续的实数值，还是离散的标签，区分为回归任务和分类任务。因为房价是一个连续值，所以房价预测显然是一个回归任务。 数据归一化处理","categories":[{"name":"深度学习","slug":"深度学习","permalink":"http://xiaohongzhong.top/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"paddle","slug":"paddle","permalink":"http://xiaohongzhong.top/tags/paddle/"}]},{"title":"conda的使用","slug":"conda的使用","date":"2020-11-23T13:00:20.000Z","updated":"2020-11-27T03:15:49.858Z","comments":true,"path":"2020/11/23/conda-de-shi-yong/","link":"","permalink":"http://xiaohongzhong.top/2020/11/23/conda-de-shi-yong/","excerpt":"安装Anaconda","text":"安装Anaconda 首先需要安装anaconda，在不同的电脑上下载使用很多次了，还是挺方便的。正好开通了博客，就记录下conda的使用。 conda 创建虚拟环境anaconda安装成功之后，如果不成功，网上很多安装的博客可以查看。应该有conda命令了。 conda -V 返回conda 4.7.12 1.创建虚拟环境命令：conda create --name pytorch python=3.6.5 安装总是失败 123Collecting package metadata (current_repodata.json): ...working... doneSolving environment: ...working... failed with repodata from current_repodata.json, will retry with next repodata source.Collecting package metadata (repodata.json): ...working... 我添加了conda换源，可是还是不行 123conda config --add channels https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;free&#x2F;conda config --add channels https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;main&#x2F;conda config --set show_channel_urls yes 修改命令conda create --name pytorch python=3.6 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849$ conda create -n tensorflow python&#x3D;3.6.5Collecting package metadata (repodata.json): doneSolving environment: done&#x3D;&#x3D;&gt; WARNING: A newer version of conda exists. &lt;&#x3D;&#x3D; current version: 4.8.3 latest version: 4.9.2Please update conda by running $ conda update -n base -c defaults conda## Package Plan ## environment location: C:\\Users\\DELL\\Anaconda3\\envs\\tensorflow added &#x2F; updated specs: - python&#x3D;3.6.5The following packages will be downloaded: package | build ---------------------------|----------------- certifi-2020.11.8 | py36haa95532_0 151 KB pip-20.2.4 | py36haa95532_0 2.1 MB python-3.6.5 | h0c2934d_0 21.6 MB setuptools-50.3.1 | py36haa95532_1 939 KB vc-14.1 | h0510ff6_4 6 KB vs2015_runtime-14.16.27012 | hf0eaf9b_3 2.4 MB wincertstore-0.2 | py36h7fe50ca_0 13 KB ------------------------------------------------------------ Total: 27.2 MBThe following NEW packages will be INSTALLED:done## To activate this environment, use## $ conda activate tensorflow## To deactivate an active environment, use## $ conda deactivate 2.安装成功之后，可以查看确认下conda env list conda 进入虚拟环境conda activate tensorflow或者source activate tensorflow conda 退出虚拟环境conda deactivate或者试试source deactivate没有退出，就多输入几次命令 conda 添加镜像conda config –add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/conda config –add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/conda config –add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/conda config –add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/#显示安装的镜像conda config –set show_channel_urls yes#已添加的channel在哪里查看.condarc conda 删除虚拟环境conda remove -n tensorflow –all 123456789101112131415161718192021222324252627conda remove -n tensorflow --allRemove all packages in environment C:\\Users\\DELL\\Anaconda3\\envs\\tensorflow:## Package Plan ## environment location: C:\\Users\\DELL\\Anaconda3\\envs\\tensorflowThe following packages will be REMOVED: certifi-2020.11.8-py36haa95532_0 pip-20.2.4-py36haa95532_0 python-3.6.5-h0c2934d_0 setuptools-50.3.1-py36haa95532_1 vc-14.1-h0510ff6_4 vs2015_runtime-14.16.27012-hf0eaf9b_3 wheel-0.35.1-pyhd3eb1b0_0 wincertstore-0.2-py36h7fe50ca_0Proceed ([y]&#x2F;n)? yPreparing transaction: doneVerifying transaction: doneExecuting transaction: done 我正常用的就是这些命令，记录一下。","categories":[{"name":"环境搭建","slug":"环境搭建","permalink":"http://xiaohongzhong.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"anaconda","slug":"anaconda","permalink":"http://xiaohongzhong.top/tags/anaconda/"}]},{"title":"初识pytorch broatcasting","slug":"初识pytorch","date":"2020-11-22T13:11:19.000Z","updated":"2020-11-22T15:11:20.000Z","comments":true,"path":"2020/11/22/chu-shi-pytorch/","link":"","permalink":"http://xiaohongzhong.top/2020/11/22/chu-shi-pytorch/","excerpt":"","text":"","categories":[{"name":"Pytorch","slug":"Pytorch","permalink":"http://xiaohongzhong.top/categories/Pytorch/"}],"tags":[{"name":"pytorch","slug":"pytorch","permalink":"http://xiaohongzhong.top/tags/pytorch/"}]},{"title":"装备栏","slug":"装备栏","date":"2020-11-19T06:28:49.000Z","updated":"2020-11-22T15:33:22.000Z","comments":true,"path":"2020/11/19/zhuang-bei-lan/","link":"","permalink":"http://xiaohongzhong.top/2020/11/19/zhuang-bei-lan/","excerpt":"这里是我日常使用的一些工具","text":"这里是我日常使用的一些工具，主要是Windows上的，也有Ubuntu的。编辑器：Atom （使用体验超级好）Packages：1.Hydropen2.activate_power_mode3.atom_python_run4.atom_terminal5.autocomplete-python6.hyperclick7.ide-python8.kite # 特别好用，使用有惊喜9.minimap10.python-tools11.run-in-terminal其他很多包全是core packages，不进行列举。 远程连接传输工具：Xshell Winscp PuttyCoding：Pycharm Anaconda Visual-Studio Source-Insight数据库：HeidiSQL查看神经网络的结构：NetronCuda：v10.0Cudnn：v7.6.5查看windows文件：listary","categories":[{"name":"开发工具","slug":"开发工具","permalink":"http://xiaohongzhong.top/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"工具","slug":"工具","permalink":"http://xiaohongzhong.top/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"还有30秒到达战场","slug":"还有30秒到达战场","date":"2020-11-18T03:11:54.000Z","updated":"2020-11-22T15:32:56.000Z","comments":true,"path":"2020/11/18/huan-you-30-miao-dao-da-zhan-chang/","link":"","permalink":"http://xiaohongzhong.top/2020/11/18/huan-you-30-miao-dao-da-zhan-chang/","excerpt":"我知道它们为什么发出滴答滴答的声音了","text":"我知道它们为什么发出滴答滴答的声音了，我也知道怎样让它们停下来 ——发条 我疯了？呵，很有可能 ——锤石 世间万物皆系于一箭之上 ——艾希 管好你的嘴，小鬼，否则你会发现自己正躺在基地等重生 ——赏金猎人 荣耀存于心，而非留于形我还在寻找，回家的路长路漫漫，唯剑做伴且随疾风前行，身后一许流星吾虽浪迹天涯，却未迷失本心 ——疾风剑豪","categories":[{"name":"英雄联盟","slug":"英雄联盟","permalink":"http://xiaohongzhong.top/categories/%E8%8B%B1%E9%9B%84%E8%81%94%E7%9B%9F/"}],"tags":[{"name":"游戏","slug":"游戏","permalink":"http://xiaohongzhong.top/tags/%E6%B8%B8%E6%88%8F/"}]},{"title":"Hello World","slug":"hello-world","date":"2020-11-18T02:11:54.000Z","updated":"2020-11-22T15:34:12.000Z","comments":true,"path":"2020/11/18/hello-world/","link":"","permalink":"http://xiaohongzhong.top/2020/11/18/hello-world/","excerpt":"Welcome to Hexo!","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[{"name":"项目经验","slug":"项目经验","permalink":"http://xiaohongzhong.top/categories/%E9%A1%B9%E7%9B%AE%E7%BB%8F%E9%AA%8C/"},{"name":"深度学习","slug":"深度学习","permalink":"http://xiaohongzhong.top/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"环境搭建","slug":"环境搭建","permalink":"http://xiaohongzhong.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"},{"name":"Pytorch","slug":"Pytorch","permalink":"http://xiaohongzhong.top/categories/Pytorch/"},{"name":"开发工具","slug":"开发工具","permalink":"http://xiaohongzhong.top/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"},{"name":"英雄联盟","slug":"英雄联盟","permalink":"http://xiaohongzhong.top/categories/%E8%8B%B1%E9%9B%84%E8%81%94%E7%9B%9F/"}],"tags":[{"name":"爬虫","slug":"爬虫","permalink":"http://xiaohongzhong.top/tags/%E7%88%AC%E8%99%AB/"},{"name":"python","slug":"python","permalink":"http://xiaohongzhong.top/tags/python/"},{"name":"paddle","slug":"paddle","permalink":"http://xiaohongzhong.top/tags/paddle/"},{"name":"anaconda","slug":"anaconda","permalink":"http://xiaohongzhong.top/tags/anaconda/"},{"name":"pytorch","slug":"pytorch","permalink":"http://xiaohongzhong.top/tags/pytorch/"},{"name":"工具","slug":"工具","permalink":"http://xiaohongzhong.top/tags/%E5%B7%A5%E5%85%B7/"},{"name":"游戏","slug":"游戏","permalink":"http://xiaohongzhong.top/tags/%E6%B8%B8%E6%88%8F/"}]}